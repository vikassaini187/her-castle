window.addEventListener("DOMContentLoaded",function(){function e(e,t,n){for(var i=0;i<e.length;i++)t.call(n,e[i],i)}function t(){jQuery(".omnibar-additional-custom-field").select2({maximumSelectionLength:10,placeholder:"Select Up to Ten Fields"}),jQuery(".omnibar-address-multiselect").select2({placeholder:"Select MLS"})}function n(){"undefined"!=typeof v&&v.addEventListener("click",function(e){e.preventDefault(),jQuery(".status").fadeIn("fast").html(g+"Saving Settings..."),d(),y(),m()})}function i(){e(b,function(e){e.addEventListener("change",l)})}function o(){jQuery(j).on("change",u)}function l(){return e(b,function(e){var t=e.name,n=e.value;"basic"!==t&&r(t,n)}),u()}function r(t,n){var i=j.querySelectorAll("."+t)[0],o=i.querySelectorAll("option");return e(o,function(e){e.getAttribute("data-mlsptid")!==n?e.disabled=!0:e.disabled=!1,"listingAgentID"!=e.getAttribute("value")&&"listingOfficeID"!=e.getAttribute("value")&&"coListingAgentID"!=e.getAttribute("value")&&"coListingOfficeID"!=e.getAttribute("value")&&"tertiaryListingAgentID"!=e.getAttribute("value")&&"tertiaryListingOfficeID"!=e.getAttribute("value")||(e.disabled=!0)}),a(j)}function a(e){return jQuery(e).select2("destroy"),jQuery(e).select2()}function u(){c();var t=j.selectedOptions;e(t,function(e){try{if(e.disabled===!0)throw e}catch(t){s(t.title)}})}function c(){document.querySelectorAll(".select2-container--default")[0].classList.remove("warning"),A.style.display="none",A.querySelector("p").innerHTML=""}function s(e){var t=e+" is not in the selected property type. Please choose a Custom Field within the selected MLS Specific Property Type.<br>";A.querySelector("p").insertAdjacentHTML("beforeend",t),A.style.display="block",document.querySelectorAll(".select2-container--default")[0].classList.add("warning")}function d(){if("undefined"!=typeof document.querySelectorAll(".city-list")[0]){var e=jQuery(".city-list select").val(),t=jQuery(".county-list select").val(),n=jQuery(".zipcode-list select").val();jQuery.post(ajaxurl,{action:"idx_update_omnibar_current_ccz","city-list":e,"county-list":t,"zipcode-list":n},function(){p()})}}function f(){var e=0,t=0;return function(n){if(1!==+n&&0!==+n||(t+=+n),e++,e>=3){var i="custom";t>0&&(i="all"),jQuery.post(ajaxurl,{action:"idx_update_database",toUpdate:i},function(){window.location.reload()}),e=0,t=0}}}function p(){if(void 0!==j.options){for(var e=[],t=0;t<j.options.length;t++)if(j.options[t].selected){var n=j.options[t].parentNode.classList[0],i=j.options[t].value,o=j.options[t].label,l=j.options[t].getAttribute("data-mlsptid"),r={idxID:n,value:i,mlsPtID:l,name:o};e.push(r)}for(var a=[],t=0;t<b.length;t++){var n=b[t].name,i=b[t].value,u={idxID:n,mlsPtID:i};a.push(u)}var c=document.querySelectorAll(".omnibar-placeholder")[0].value;jQuery.post(ajaxurl,{action:"idx_update_omnibar_custom_fields",fields:e,mlsPtIDs:a,placeholder:c},function(e){S(e)})}}function y(){var e=document.getElementById("sort-order");jQuery.post(ajaxurl,{action:"idx_update_sort_order","sort-order":e.options[e.selectedIndex].value},function(e){S(e)})}function m(){var e=jQuery("#omnibar-address-mls");jQuery.post(ajaxurl,{action:"idx_update_address_mls","address-mls":e.val()},function(e){S(e)})}"undefined"!=typeof loadOmnibarView&&jQuery.post(ajaxurl,{action:"idx_preload_omnibar_settings_view"},function(){window.location.reload()});var v=document.querySelectorAll("#save_changes")[0],g="<span class='ajax'></span>",b=document.querySelectorAll(".omnibar-mlsPtID"),j=(document.querySelectorAll(".sort-order"),document.querySelectorAll(".omnibar-additional-custom-field")[0]),A=document.querySelectorAll(".customFieldError")[0];!function(){t(),n(),l(),i(),o()}();var S=f()});